---
title: MySQL——锁机制
date: 2020-02-06
author: liuwei
location: Zhengzhou
---

<p>&emsp;&emsp;MySQL支持多线程，在同时处理多个请求时，修改同一处数据就会用到锁操作，这里只涉及InnoDB存储引擎。</p>

### 读锁与写锁

<p>&emsp;&emsp;在使用没有事务处理的存储引擎时，可以通过锁表方式控制事务。</p>

1. 读锁（共享锁）：其他事务可以读取，不可以写入;

```sql
lock table mylist read;
unlock tables;
```
2. 写锁（排他锁）：其他事务不可读取，不可写入。

```sql
lock table mylist write;
unlock tables;
```

### 行锁与表锁

1. 行锁：锁一行，只有在操作同一行时会出现阻塞，开销大，锁表慢，在高并发下性能表现好；
2. 表锁：锁整张表，只要操作同一张表就会阻塞，开销小，锁表快，高并发下性能表现不好；
3. 行锁是在索引检索时产生的，如果检索了非索引列，会产生表锁。

### 悲观锁与乐观锁

1. 悲观锁：在事务开始执行时就上锁，在查询语句后加上**for update**关键字，这样其他事务执行同一个代码时就会发生阻塞；
2. 乐观锁：在事务进行提交时判断操作的数据是否在事务期间发生了改变，如果改变了则事务操作失败。通过数据版本号或者时间戳来判断数据变化。
3. 悲观锁阻塞查询，乐观锁容易产生数据更新失败，根据不同需求进行选择。在使用时，如果读取的操作比较多就使用乐观锁，防止读取长期阻塞，缺点是会出现数据更新失败；如果写入的操作多使用悲观锁。
